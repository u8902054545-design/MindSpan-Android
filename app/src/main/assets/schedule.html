<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расписание слотов с загрузкой</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --md-sys-color-surface: #131314;
            --md-sys-color-on-surface: #E3E3E3;
            --md-sys-color-surface-container: #1C1C1E;
            --md-sys-color-primary: #0000FF;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-on-surface-variant: #C4C7C5;
            --md-sys-color-divider: rgba(255, 255, 255, 0.1);
            --spinner-primary: #a8c7fa;
        }
        body {
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            overflow-x: hidden;
        }
        .app-container {
            width: 100%;
            max-width: 400px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .header-calendar {
            background-color: var(--md-sys-color-surface-container);
            padding: 24px 16px 32px 20px;
            border-bottom-left-radius: 32px;
            border-bottom-right-radius: 32px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            z-index: 10;
        }
        .header-titles { margin-bottom: 24px; }
        .calendar-title { font-size: 26px; font-weight: 900; margin: 0; color: var(--md-sys-color-on-surface); letter-spacing: -0.5px; }
        .instruction-text { font-size: 14px; font-weight: 500; color: var(--md-sys-color-on-surface-variant); margin-top: 4px; opacity: 0.9; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px 4px; text-align: center; }
        .weekday { color: var(--md-sys-color-primary); font-size: 11px; font-weight: 700; height: 32px; display: flex; align-items: center; justify-content: center; }
        .calendar-divider { grid-column: span 7; height: 1px; background-color: var(--md-sys-color-divider); margin: 0 0 8px 0; }
        .month-nav-row { grid-column: span 7; display: flex; justify-content: space-between; align-items: center; padding: 0 4px 12px 4px; }
        .month-display { font-size: 18px; color: var(--md-sys-color-on-surface); font-weight: 700; text-transform: capitalize; }
        .nav-island { display: flex; align-items: center; background: rgba(255, 255, 255, 0.04); padding: 2px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); }
        .nav-divider { width: 1px; height: 14px; background-color: rgba(255, 255, 255, 0.1); margin: 0 2px; }
        .btn-nav { background: transparent; border: none; color: var(--md-sys-color-on-surface); width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .btn-nav:hover:not(:disabled) { background-color: rgba(255, 255, 255, 0.1); color: var(--md-sys-color-primary); }
        .btn-nav:disabled { opacity: 0.15; cursor: default; }
        .btn-nav svg { width: 16px; height: 16px; fill: currentColor; }
        .day-cell { height: 44px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border-radius: 12px; font-size: 14px; font-weight: 500; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); border: 2px solid transparent; position: relative; }
        .day-cell.inactive { color: #3c3c3c; cursor: default; }
        .day-cell.today { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); font-weight: 700; }
        .day-cell.selected:not(.today) { border-color: var(--md-sys-color-primary); }
        .day-cell.has-shift::after { content: ''; position: absolute; bottom: 6px; width: 12px; height: 2px; background-color: var(--md-sys-color-primary); border-radius: 2px; transition: background-color 0.2s; }
        .day-cell.today.has-shift::after { background-color: var(--md-sys-color-on-primary); }
        .day-cell:hover:not(.inactive):not(.today) { background-color: rgba(255, 255, 255, 0.05); }
        .bottom-sheet-backdrop { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 100; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; }
        .bottom-sheet-backdrop.active { opacity: 1; visibility: visible; }
        .bottom-sheet { position: fixed; bottom: 0; left: 50%; transform: translate(-50%, 100%); width: 100%; max-width: 400px; background-color: var(--md-sys-color-surface-container); border-top-left-radius: 28px; border-top-right-radius: 28px; z-index: 101; padding: 12px 20px 32px 20px; transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1); box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.5); max-height: 85vh; overflow-y: auto; }
        .bottom-sheet.active { transform: translate(-50%, 0); }
        .bottom-sheet-handle { width: 32px; height: 4px; background-color: var(--md-sys-color-on-surface-variant); border-radius: 2px; margin: 0 auto 20px auto; opacity: 0.4; }
        .bottom-sheet-header { margin-bottom: 24px; }
        .bottom-sheet-title { font-size: 20px; font-weight: 700; color: var(--md-sys-color-on-surface); margin-bottom: 4px; }
        .bottom-sheet-subtitle { font-size: 14px; color: var(--md-sys-color-on-surface-variant); }
        .sheet-section { margin-bottom: 24px; }
        .section-title { font-size: 12px; font-weight: 700; letter-spacing: 0.5px; color: var(--md-sys-color-primary); margin-bottom: 12px; display: block; }
        .slots-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .slot-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; padding: 16px; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; }
        .slot-card.planned { border-left: 4px solid var(--md-sys-color-primary); background: rgba(0, 0, 255, 0.05); }
        .slot-content-wrapper { display: flex; align-items: center; gap: 16px; }
        .slot-icon-svg { width: 24px; height: 24px; fill: var(--md-sys-color-on-surface-variant); flex-shrink: 0; }
        .slot-card.planned .slot-icon-svg { fill: var(--md-sys-color-primary); }
        .slot-info { display: flex; flex-direction: column; gap: 2px; }
        .slot-time { font-weight: 700; font-size: 16px; color: var(--md-sys-color-on-surface); }
        .slot-role { font-size: 13px; color: var(--md-sys-color-on-surface-variant); }
        .slot-action { font-size: 12px; font-weight: 700; padding: 8px 16px; border-radius: 12px; background: rgba(255, 255, 255, 0.05); color: var(--md-sys-color-on-surface); cursor: pointer; white-space: nowrap; }
        .slot-action.btn-add { background: var(--md-sys-color-primary); color: white; }
        .empty-state { font-size: 14px; color: #555; padding: 12px 0; font-style: italic; }
        #loader-wrapper { display: none; flex-direction: column; align-items: center; padding: 40px 0; width: 100%; }
        .spinner { width: 42px; height: 42px; animation: rotate-container 2.4s linear infinite; }
        .spinner svg { width: 100%; height: 100%; }
        .spinner circle { fill: none; stroke: var(--spinner-primary); stroke-width: 4.5; stroke-linecap: round; animation: dash-sync 1.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; }
        @keyframes rotate-container { 100% { transform: rotate(360deg); } }
        @keyframes dash-sync { 0% { stroke-dasharray: 1, 150; stroke-dashoffset: 0; } 50% { stroke-dasharray: 100, 150; stroke-dashoffset: -15; } 100% { stroke-dasharray: 1, 150; stroke-dashoffset: -125; } }
        .hidden-content { display: none !important; }
    </style>
</head>
<body>
<div class="app-container">
    <div class="header-calendar">
        <div class="header-titles">
            <h1 class="calendar-title">Выберите день</h1>
            <p class="instruction-text">Затем, выберите удобное время смены</p>
        </div>
        <div class="calendar-grid" id="calendarGrid">
            <div class="weekday">Пн</div><div class="weekday">Вт</div><div class="weekday">Ср</div><div class="weekday">Чт</div><div class="weekday">Пт</div><div class="weekday">Сб</div><div class="weekday">Вс</div>
            <div class="calendar-divider"></div>
            <div class="month-nav-row">
                <span id="currentMonthYear" class="month-display"></span>
                <div class="nav-island">
                    <button id="prevMonth" class="btn-nav" onclick="changeMonth(-1)"><svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg></button>
                    <div class="nav-divider"></div>
                    <button id="nextMonth" class="btn-nav" onclick="changeMonth(1)"><svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg></button>
                </div>
            </div>
        </div>
    </div>
    <div class="bottom-sheet-backdrop" id="sheetBackdrop" onclick="closeBottomSheet()"></div>
    <div class="bottom-sheet" id="bottomSheet">
        <div class="bottom-sheet-handle"></div>
        <div id="loader-wrapper"><div class="spinner"><svg viewBox="0 0 50 50"><circle cx="25" cy="25" r="20"></circle></svg></div></div>
        <div id="sheetContent">
            <div class="bottom-sheet-header">
                <h2 class="bottom-sheet-title" id="sheetTitle">Смены на дату</h2>
                <p class="bottom-sheet-subtitle">Управление вашим расписанием</p>
            </div>
            <div class="sheet-section" id="plannedSection"><span class="section-title">Запланированные</span><div class="slots-grid" id="plannedSlots"></div></div>
            <div class="sheet-section" id="availableSection"><span class="section-title">Доступные</span><div class="slots-grid" id="availableSlots"></div></div>
        </div>
    </div>
</div>
<script>
    let currentViewDate = new Date();
    const today = new Date(); today.setHours(0,0,0,0);
    let selectedDate = new Date(today);
    const maxActiveDate = new Date(today); maxActiveDate.setDate(today.getDate() + 13);
    const monthNames = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
    function hasPlannedShifts(date) { return isWorkingDay(date) && date.getDate() % 4 === 0; }
    function isWorkingDay(date) { return date >= today && date <= maxActiveDate && date.getDate() % 2 === 0; }
    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const monthLabel = document.getElementById('currentMonthYear');
        const persistentElements = 9; 
        while (grid.children.length > persistentElements) { grid.removeChild(grid.lastChild); }
        monthLabel.innerText = `${monthNames[currentViewDate.getMonth()]} ${currentViewDate.getFullYear()}`;
        const prevBtn = document.getElementById('prevMonth');
        const nextBtn = document.getElementById('nextMonth');
        prevBtn.disabled = currentViewDate.getMonth() === today.getMonth() && currentViewDate.getFullYear() === today.getFullYear();
        const nextMonthLimit = new Date(today); nextMonthLimit.setMonth(today.getMonth() + 1);
        nextBtn.disabled = currentViewDate.getMonth() === nextMonthLimit.getMonth() && currentViewDate.getFullYear() === nextMonthLimit.getFullYear();
        const firstDayOfMonth = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth(), 1);
        const lastDayOfMonth = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth() + 1, 0);
        let startDay = firstDayOfMonth.getDay(); startDay = startDay === 0 ? 6 : startDay - 1;
        for (let i = 0; i < startDay; i++) { grid.appendChild(document.createElement('div')); }
        for (let day = 1; day <= lastDayOfMonth.getDate(); day++) {
            const dateObj = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth(), day);
            const cell = document.createElement('div');
            cell.className = 'day-cell'; cell.innerText = day;
            if (dateObj.getTime() === today.getTime()) cell.classList.add('today');
            if (dateObj.getTime() === selectedDate.getTime()) cell.classList.add('selected');
            if (hasPlannedShifts(dateObj)) cell.classList.add('has-shift');
            if (!(dateObj >= today && dateObj <= maxActiveDate)) { cell.classList.add('inactive'); }
            else { cell.onclick = () => { selectedDate = new Date(dateObj); renderCalendar(); openBottomSheet(dateObj); }; }
            grid.appendChild(cell);
        }
    }
    function changeMonth(offset) { currentViewDate.setMonth(currentViewDate.getMonth() + offset); renderCalendar(); }
    function openBottomSheet(date) {
        const sheet = document.getElementById('bottomSheet');
        const backdrop = document.getElementById('sheetBackdrop');
        const loader = document.getElementById('loader-wrapper');
        const content = document.getElementById('sheetContent');
        const title = document.getElementById('sheetTitle');
        const plannedContainer = document.getElementById('plannedSlots');
        const availableContainer = document.getElementById('availableSlots');
        backdrop.classList.add('active'); sheet.classList.add('active');
        document.body.style.overflow = 'hidden'; content.classList.add('hidden-content'); loader.style.display = 'flex';
        setTimeout(() => {
            title.innerText = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
            plannedContainer.innerHTML = ''; availableContainer.innerHTML = '';
            if (hasPlannedShifts(date)) {
                document.getElementById('plannedSection').style.display = 'block';
                plannedContainer.innerHTML = createSlotHTML("08:00 - 12:00 (4ч)", true);
                if (date.getDate() % 8 === 0) {
                    availableContainer.innerHTML = createSlotHTML("12:00 - 16:00 (4ч)", false);
                    availableContainer.innerHTML += createSlotHTML("16:00 - 20:00 (4ч)", false);
                } else { availableContainer.innerHTML = '<div class="empty-state">Нет доступных смен</div>'; }
            } else {
                document.getElementById('plannedSection').style.display = 'none';
                availableContainer.innerHTML = createSlotHTML("10:00 - 14:00 (4ч)", false);
                availableContainer.innerHTML += createSlotHTML("14:00 - 18:00 (4ч)", false);
            }
            loader.style.display = 'none'; content.classList.remove('hidden-content');
        }, 1500);
    }
    function createSlotHTML(time, isPlanned) {
        const actionText = isPlanned ? "Отменить" : "Запланировать";
        const actionClass = isPlanned ? "" : "btn-add";
        const icon = isPlanned ? `<svg class="slot-icon-svg" viewBox="0 0 24 24"><path d="M16.53 11.06L15.47 10l-4.88 4.88-2.12-2.12-1.06 1.06L10.59 17l5.94-5.94zM19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg>` : `<svg class="slot-icon-svg" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>`;
        return `<div class="slot-card ${isPlanned?'planned':''}"><div class="slot-content-wrapper">${icon}<div class="slot-info"><span class="slot-time">${time}</span><span class="slot-role">Разработчик MindSpan:CLI</span></div></div><div class="slot-action ${actionClass}" onclick="closeBottomSheet()">${actionText}</div></div>`;
    }
    function closeBottomSheet() { document.getElementById('bottomSheet').classList.remove('active'); document.getElementById('sheetBackdrop').classList.remove('active'); document.body.style.overflow = ''; }
    window.onload = renderCalendar;
</script>
</body>
</html>
